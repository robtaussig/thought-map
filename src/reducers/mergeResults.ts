import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { Selector } from 'react-redux';
import { MergeResults, Item, Comparable } from '../components/Merge/types';
import { RootState } from './';

const MOCKED = `{"itemsToAdd":[{"collectionName":"thought","item":{"title":"rerer","type":"Task","date":"","time":"","description":"","priority":5,"sections":"","created":1580435541740,"updated":1580435542290,"status":"new","id":"b7df6d4d-9292-48e8-945d-b91ede684651"}},{"collectionName":"status","item":{"text":"won't fix","thoughtId":"7044c7cc-e3fb-4b38-ac2d-6408b49c179f","created":1580435464390,"updated":1580435464390,"id":"041688f1-a0f7-4781-ae8a-5be0e90629c1"}},{"collectionName":"status","item":{"text":"won't fix","thoughtId":"aaeb842c-9e0d-4f86-9bb6-e484a48fbe4e","created":1580435467343,"updated":1580435467343,"id":"75a02bba-0c09-4d24-975c-729d87b2ea67"}},{"collectionName":"status","item":{"thoughtId":"b7df6d4d-9292-48e8-945d-b91ede684651","text":"new","created":1580435542170,"updated":1580435542170,"id":"75afee6f-2fc6-4639-8eaf-647e467f52e5"}},{"collectionName":"status","item":{"text":"in progress","thoughtId":"5a907edd-b81c-416b-a86f-fa19f48f36bc","created":1580435461658,"updated":1580435461658,"id":"ecff1a98-49db-4837-9628-db6c7053e2eb"}},{"collectionName":"thought","item":{"title":"newby","type":"Task","date":"","time":"","description":"","priority":5,"sections":"","created":1580435748910,"updated":1580435749482,"status":"new","id":"09c6948c-edb6-4025-91ce-c6f5b7e81c3d"}},{"collectionName":"thought","item":{"title":"Fix body scroll mechanics","type":"Task","date":"","time":"","description":"","priority":10,"sections":"","planId":"797e956f-0cfd-4ed3-bbdf-c4acfaceb02a","created":1580245528259,"updated":1580312899481,"status":"new","id":"3618f375-0577-4460-9e5b-48186f812caa"}},{"collectionName":"thought","item":{"title":"rerer","type":"Misc","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1580435784776,"updated":1580435785024,"status":"new","id":"558a9569-ad84-45bd-b4aa-636b129233f7"}},{"collectionName":"thought","item":{"title":"qweqwe","type":"Misc","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1580435789574,"updated":1580435789800,"status":"new","id":"d4412145-0452-43bf-b0ba-1a2e3f706740"}},{"collectionName":"note","item":{"thoughtId":"3618f375-0577-4460-9e5b-48186f812caa","text":"Try keeping body in gets cell, fixing nav position, and leaving nav cell empty","created":1580312936927,"updated":1580312936927,"id":"f56890bb-4467-43ce-8c26-2d23ddd05f0d"}},{"collectionName":"connection","item":{"from":"90c2b09c-0f5d-4140-88a3-2c7dcb1502c1","to":"d4412145-0452-43bf-b0ba-1a2e3f706740","created":1580435790186,"updated":1580435790186,"id":"3ccaa342-422c-48f4-b581-8da70c59fc11"}},{"collectionName":"connection","item":{"from":"90c2b09c-0f5d-4140-88a3-2c7dcb1502c1","to":"558a9569-ad84-45bd-b4aa-636b129233f7","created":1580435785490,"updated":1580435785490,"id":"9dd897a5-3432-447c-baf4-960992b0aa30"}},{"collectionName":"status","item":{"thoughtId":"d4412145-0452-43bf-b0ba-1a2e3f706740","text":"new","created":1580435789774,"updated":1580435789774,"id":"15f16297-7918-4297-b9fd-168fd10f54f5"}},{"collectionName":"status","item":{"text":"completed","thoughtId":"dc34db8f-866c-436d-8a0a-9958e007fd1c","created":1580435773951,"updated":1580435773951,"id":"287217ea-734e-4b89-8884-c73f4bbc7559"}},{"collectionName":"status","item":{"text":"in progress","thoughtId":"e3529c40-5376-4356-bdc2-7a36302a13ad","created":1580435768773,"updated":1580435768773,"id":"39a30f7a-ff79-4219-8520-3f826a9061c4"}},{"collectionName":"status","item":{"text":"in progress","thoughtId":"63bb026d-0b2f-49bc-a479-a3c49c5432ea","created":1580435771629,"updated":1580435771629,"id":"43617aca-dbfe-4d72-9665-dab1b6522d7c"}},{"collectionName":"status","item":{"thoughtId":"3618f375-0577-4460-9e5b-48186f812caa","text":"new","created":1580245528326,"updated":1580245528717,"location":"40.7554984,-73.9844","id":"7a9626d4-02e7-4f6d-b312-33b31beba519"}},{"collectionName":"status","item":{"thoughtId":"558a9569-ad84-45bd-b4aa-636b129233f7","text":"new","created":1580435784981,"updated":1580435784981,"id":"94c749cb-5b87-4784-a8da-038b05fbf501"}},{"collectionName":"status","item":{"thoughtId":"09c6948c-edb6-4025-91ce-c6f5b7e81c3d","text":"new","created":1580435749367,"updated":1580435749367,"id":"baf4dc53-bc2a-4613-9272-9df7ca981519"}}],"comparables":[[{"collectionName":"thought","item":{"title":"Fix chess ui","type":"Task","date":"","time":"","description":"","priority":5,"sections":"","planId":"797e956f-0cfd-4ed3-bbdf-c4acfaceb02a","created":1580312961669,"updated":1580312961868,"status":"new","id":"3d305d34-b221-40a8-a8fc-a17e095f3ebb"}},{"collectionName":"thought","item":{"title":"Fix chess ui2","type":"Task","date":"","time":"","description":"","priority":10,"sections":"","planId":"797e956f-0cfd-4ed3-bbdf-c4acfaceb02a","created":1580312961669,"updated":1580435479105,"status":"new","id":"3d305d34-b221-40a8-a8fc-a17e095f3ebb"}}],[{"collectionName":"thought","item":{"title":"Transfer backups across import from json","type":"Feature","date":"","time":"","description":"","priority":5,"sections":"","planId":"179d3f0f-4f7d-458c-8534-d91c11db7b83","created":1580349070920,"updated":1580349071059,"status":"new","id":"5a907edd-b81c-416b-a86f-fa19f48f36bc"}},{"collectionName":"thought","item":{"title":"Transfer backups across import from json","type":"Feature","date":"","time":"","description":"","priority":5,"sections":"","planId":"179d3f0f-4f7d-458c-8534-d91c11db7b83","created":1580349070920,"updated":1580435461679,"status":"in progress","id":"5a907edd-b81c-416b-a86f-fa19f48f36bc"}}],[{"collectionName":"thought","item":{"title":"Munchie Advent calendar","type":"Misc","date":"2020-11-15","time":"22:00","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1575689870534,"updated":1580435771668,"status":"in progress","calendarLink":"https://www.google.com/calendar/event?eid=NjNiYjAyNmQwYjJmNDliY2E0NzlhM2M0OWM1NDMyZWEgcm9iZXJ0LnRhdXNzaWdAbQ","id":"63bb026d-0b2f-49bc-a479-a3c49c5432ea"}},{"collectionName":"thought","item":{"title":"Munchie Advent calendar","type":"Misc","date":"2020-11-15","time":"22:00","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1575689870534,"updated":1575689957940,"status":"new","calendarLink":"https://www.google.com/calendar/event?eid=NjNiYjAyNmQwYjJmNDliY2E0NzlhM2M0OWM1NDMyZWEgcm9iZXJ0LnRhdXNzaWdAbQ","id":"63bb026d-0b2f-49bc-a479-a3c49c5432ea"}}],[{"collectionName":"thought","item":{"title":"Fix bug with server where put action doesn't delete all chunks","type":"Feature","date":"","time":"","description":"","priority":5,"sections":"","planId":"179d3f0f-4f7d-458c-8534-d91c11db7b83","created":1580347866145,"updated":1580347866316,"status":"new","id":"7044c7cc-e3fb-4b38-ac2d-6408b49c179f"}},{"collectionName":"thought","item":{"title":"Fix bug with server where put action doesn't delete all chunks","type":"Feature","date":"","time":"","description":"","priority":5,"sections":"","planId":"179d3f0f-4f7d-458c-8534-d91c11db7b83","created":1580347866145,"updated":1580435464406,"status":"won't fix","id":"7044c7cc-e3fb-4b38-ac2d-6408b49c179f"}}],[{"collectionName":"thought","item":{"title":"Send documents to Richard","type":"task","date":"","time":"","description":"","priority":5,"sections":"","planId":"fe73b2da-cbdd-46d7-a86a-02700652f75e","created":1580329696328,"updated":1580329696482,"status":"new","id":"aaeb842c-9e0d-4f86-9bb6-e484a48fbe4e"}},{"collectionName":"thought","item":{"title":"Send documents to Richard","type":"task","date":"","time":"","description":"","priority":5,"sections":"","planId":"fe73b2da-cbdd-46d7-a86a-02700652f75e","created":1580329696328,"updated":1580435467359,"status":"won't fix","id":"aaeb842c-9e0d-4f86-9bb6-e484a48fbe4e"}}],[{"collectionName":"thought","item":{"title":"Bring dna test kit to Bermuda for clover","type":"Task","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1574706531921,"updated":1580435773964,"status":"completed","id":"dc34db8f-866c-436d-8a0a-9958e007fd1c"}},{"collectionName":"thought","item":{"title":"Bring dna test kit to Bermuda for clover","type":"Task","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1574706531921,"updated":1574706531998,"status":"new","id":"dc34db8f-866c-436d-8a0a-9958e007fd1c"}}],[{"collectionName":"thought","item":{"title":"Show Andrea Google memory album","type":"Misc","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1579882134287,"updated":1580435768784,"status":"in progress","id":"e3529c40-5376-4356-bdc2-7a36302a13ad"}},{"collectionName":"thought","item":{"title":"Show Andrea Google memory album","type":"Misc","date":"","time":"","description":"","priority":5,"sections":"","planId":"1e55e7c8-dd11-411e-aa10-fa8615cf3522","created":1579882134287,"updated":1579882134402,"status":"new","id":"e3529c40-5376-4356-bdc2-7a36302a13ad"}}]]}`

export const mergeResultsSelector: Selector<RootState, MergeResults> = state => state.mergeResults;

// const initialState: MergeResults = {
//   itemsToAdd: [],
//   comparables: [],
// };

const initialState: MergeResults = JSON.parse(MOCKED);

const mergeResults = createSlice({
  name: 'mergeResults',
  initialState,
  reducers: {
    setMergeResults(state, action: PayloadAction<MergeResults>) {
      return action.payload
    },
    removeItem(state, action: PayloadAction<number>) {
      return {
        ...state,
        itemsToAdd: state.itemsToAdd.filter((item, idx) => idx !== action.payload)
      };
    },
    addItem(state, action: PayloadAction<Item>) {
      state.itemsToAdd.push(action.payload);
    },
    resolveComparable(state, action: PayloadAction<{ comparable: Comparable, item: Item }>) {
      return {
        ...state,
        itemsToAdd: state.itemsToAdd.concat(action.payload.item),
        comparables: state.comparables.filter(prevComparable => prevComparable !== action.payload.comparable),
      };
    }
  }
});

export const {
  setMergeResults,
  addItem,
  removeItem,
  resolveComparable,
} = mergeResults.actions;

export default mergeResults.reducer;
